# ุงุณุชุฑุงุชูุฌูุงุช ุงููุฑุงุกุฉ ุงูููุฑูุฉ ุจุฏูู ุญุฏูุฏ ๐

## ุงููุดููุฉ ุงูุฃุตููุฉ

ุงููุธุงู ุงูุญุงูู ูุณุชุฎุฏู **Polling** (ูุญุต ุฏูุฑู):

- ูู 30 ุซุงููุฉ: ูุณุฃู Microsoft "ูู ูู ุฑุณุงุฆู ุฌุฏูุฏุฉุ"
- ูุฐุง ูุณุจุจ **ุชุฃุฎูุฑ ูู 0-30 ุซุงููุฉ** ูุจู ุงูุชุดุงู ุงูุฑุณุงูุฉ

---

## ุงูุญู 1: ุชูููู Polling (ุชู ุชุทุจููู โ)

```
30s โ 10s โ 5s
```

**ุงููุชูุฌุฉ**: ุชุฃุฎูุฑ ุฃูู ููู ูุง ูุฒุงู ููุฌุฏ ุชุฃุฎูุฑ

---

## ุงูุญู 2: Webhooks (ุงููุฑุงุกุฉ ุงูููุฑูุฉ) - ุงูุชุงูู ๐ฏ

### ูุง ูู Webhookุ

ุจุฏู ุฃู ูุณุฃู Microsoft ูู 10 ุซูุงูู...
**Microsoft ุชุฎุจุฑูุง ููุฑุงู** ุนูุฏ ูุตูู ุฑุณุงูุฉ ุฌุฏูุฏุฉ

### ุงููุฎุทุท:

```
Without Webhooks (Current):
==========================
ุงูุฑุณุงูุฉ ุชุตู โ ูุชูุธุฑ 10 ุซุงููุฉ โ ููุญุต โ ูุนุงูุฌ
       โ__________ ุชุฃุฎูุฑ ูููู ุฅูู 10 ุซูุงูู __________โ

ูุน Webhooks (ุงููุณุชูุจู):
========================
ุงูุฑุณุงูุฉ ุชุตู โ Microsoft โ ุฅุดุนุงุฑ ููุฑู (ููู ุซุงููุฉ) โ ูุนุงูุฌ
       โ______ ุชุฃุฎูุฑ ูุฑูุจ ุฌุฏุงู ________โ
```

### ุงููุงุฆุฏุฉ:

- โ ูุฑุงุกุฉ ููุฑูุฉ ุชูุฑูุจุงู
- โ ูุง ุญุงุฌุฉ ูู polling ุงููุชูุฑุฑ
- โ ุชูููุฑ ุงุณุชููุงู API
- โ ูุง ุญุฏูุฏ ุนูููุฉ

---

## ุงูุญู 3: ุชุญุณููุงุช ูุชูุฏูุฉ (ูููู ุชุทุจูููุง ุงูุขู)

### ุฎูุงุฑ ุฃ: Increase Memory & Resources

```yaml
Larger Batch Processing:
  BATCH_SIZE: ูู 8 โ 16 (ููู ูุญุชุงุฌ RAM ุฃูุซุฑ)

Higher Concurrency:
  WORKER_CONCURRENCY: ูู 5 โ 20 (ููู ูุญุชุงุฌ threads ุฃูุซุฑ)
```

### ุฎูุงุฑ ุจ: Database Caching

```javascript
// ุจุฏู ุฌูุจ ูู ุฑุณุงูุฉ ูู API
// ุงุญูุธ ูู cache ูุญูู ุฃุณุฑุน
Redis Cache Layer:
  - ุญูุธ ูุนูููุงุช ุงูุฑุณุงุฆู ูุคูุชุงู
  - ุชูููู ุนุฏุฏ ุทูุจุงุช API
  - ุฃุณุฑุน 100x
```

### ุฎูุงุฑ ุฌ: Priority Queue

```
ูุนุงูุฌุฉ ุงูุฑุณุงุฆู ุงููููุฉ ุฃููุงู:
1. ุฑุณุงุฆู ูู ุจุฑูุฏ ุงููุงุฑุฏ ุงูุฑุฆูุณู
2. ุฑุณุงุฆู ุจู attachments
3. ุงูุฑุณุงุฆู ุงูุฃุฎุฑู

ูุฐุง ูุนุทู ุงูุทุจุงุน "ูุฑุงุกุฉ ููุฑูุฉ" ููุฑุณุงุฆู ุงููููุฉ
```

---

## ุฎุทุฉ ุงูุชุทุจูู: Webhooks

### ุงูุฎุทูุฉ 1: ุชุณุฌูู Webhook ูุน Microsoft

```javascript
POST https://graph.microsoft.com/v1.0/subscriptions
{
  "changeType": "created",
  "notificationUrl": "https://yourserver.com/api/webhooks/mail",
  "resource": "/me/mailFolders('Inbox')/messages",
  "expirationDateTime": "2026-03-07T18:23:45.9356913Z",
  "clientState": "secretClientValue"
}
```

### ุงูุฎุทูุฉ 2: Webhook Endpoint

```javascript
// ูู server.js
app.post("/api/webhooks/mail", async (req, res) => {
  // ุงูุชุญูู ูู ุงูุชูููุน
  // ุฅุถุงูุฉ ุงูุฑุณุงูุฉ ุฅูู Queue ุงูููุฑู
  // ูุนุงูุฌุฉ ููุฑูุฉ

  // ุงูุฑุฏ ุจ 202 Accepted
  res.status(202).send();
});
```

### ุงูุฎุทูุฉ 3: ูุนุงูุฌุฉ ููุฑูุฉ

```javascript
addToImmediateQueue(message) {
  // Queue ูููุตู ููุฑุณุงุฆู ุงูููุฑูุฉ
  // ุจุฏู ุงูุงูุชุธุงุฑ ุญุชู ุฏูุฑุฉ Polling ุงูุชุงููุฉ
  // ูุนุงูุฌุฉ ุฎูุงู ููู ุซุงููุฉ
}
```

---

## ุงูููุงุฑูุฉ ุงููุงููุฉ

| ุงููููุงุณ         | Polling (ูุจู) | Polling (ุจุนุฏ) | Webhooks   |
| --------------- | ------------- | ------------- | ---------- |
| **ุงูุชุฃุฎูุฑ**     | 0-30 ุซุงููุฉ    | 0-10 ุซูุงูู    | <100ms     |
| **ุงุณุชููุงู API** | ุนุงูู          | ูุนุชุฏู         | ููุฎูุถ ุฌุฏุงู |
| **ุงูุชุนููุฏ**     | ุจุณูุท          | ุจุณูุท          | ูุชูุณุท      |
| **ุงูููุซูููุฉ**   | ุนุงููุฉ         | ุนุงููุฉ         | ุนุงููุฉ ุฌุฏุงู |
| **ุงูุฌูุฏ**       | 0 (ุชู)        | 0 (ุชู)        | ~4 ุณุงุนุงุช   |

---

## ุงูุฅุนุฏุงุฏุงุช ุงูุญุงููุฉ (ุจุนุฏ ุงูุชุญุณููุงุช)

```env
# ุงูุชุฃุฎูุฑ ุงูุฃูุตู ุงูุขู: 10 ุซูุงูู
POLL_INTERVAL_MS=10000

# ูุนุงูุฌุฉ ุฃุณุฑุน
FORWARD_DELAY_MS=150
WORKER_CONCURRENCY=5

# Result: 5-6x ุฃุณุฑุน ูู ุงูุณุงุจู
```

---

## ุงูุชูุตูุงุช

### ุงูุขู (Immediate) โ

```env
# ุงูุฅุนุฏุงุฏุงุช ุงูุญุงููุฉ ูุงููุฉ ููุนุธู ุงูุญุงูุงุช
POLL_INTERVAL_MS=10000
FORWARD_DELAY_MS=150
```

### ุงููุณุชูุจู (ูุฑูุจุงู)

```
1. ุชุทุจูู Webhooks = ูุฑุงุกุฉ ููุฑูุฉ
2. Redis Caching = ุชูููุฑ API
3. Advanced Queuing = ุฃุฏุงุก ุฃูุถู
```

### ููุณุฑุนุฉ ุงูุขู (Advanced User)

```env
# ุฅุฐุง ูุงู ูุฏูู ููุงุฑุฏ ููุงูุฉ
POLL_INTERVAL_MS=3000      # ูู 3 ุซูุงูู
FORWARD_DELAY_MS=50        # 50ms ููุท
WORKER_CONCURRENCY=10      # 10 ูุชุฒุงูู
```

---

## ุงูุฎูุงุตุฉ

โ **ุชู ุชุทุจูู ุงูุชุญุณููุงุช ุงูุฃุณุงุณูุฉ**

- ูู 30 ุซุงููุฉ โ 10 ุซูุงูู
- ูู BATCH 2 โ BATCH 8
- ูู Delay 500ms โ 150ms
- **ุงููุชูุฌุฉ: 5-6x ุฃุณุฑุน**

๐ **ุงูุฎุทูุฉ ุงูุชุงููุฉ: Webhooks**

- ูุฑุงุกุฉ ููุฑูุฉ (0.1 ุซุงููุฉ)
- ุจุฏูู ุญุฏูุฏ ุนูููุฉ
- ุฌูุฏ ูุชูุณุท (~4-8 ุณุงุนุงุช)

๐ก **ุงุฎุชุฑ ุญุณุจ ุงุญุชูุงุฌู:**

- ููุงูุฉ ุณุฑุนุฉ ุงูุขูุ โ ุงุณุชุฎุฏู ุงูุฅุนุฏุงุฏุงุช ุงูุญุงููุฉ
- ุชุฑูุฏ ุฃุณุฑุนุ โ ุถุจุท ุงูู POLL_INTERVAL ุฃูุซุฑ
- ุชุฑูุฏ ููุฑู 100%ุ โ ุทุจู Webhooks
